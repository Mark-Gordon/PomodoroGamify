@using Microsoft.AspNet.Identity;
@model PomodoroGamify.Models.UserModel
@{
    ViewBag.Title = "Home Page";
}

<div id="emptyPadding"></div>
@{ }

<div class="timerDiv">
    <text id="time">25:00</text>
</div>
<div id="TimeControllerDiv">
    <button id="timerStartBtn" class="btn btn-primary" onclick="startTimer(60 * 1, $('#time'));">Start Timer</button>
    <button id="timerStopBtn" class="btn btn-primary" onclick="stopTimer();">Stop Timer</button>
</div>

<h1 id="expToLevelHeader">Level: @Model.Level <br /> Experience Till Level : @Model.GetExperienceToLevelUp() <br /> Percent: @Model.getPercentageToLevel()</h1>

@section scripts
{
    <script>

        var timer;

        function startTimer(duration, display) {
            jQuery("#timerStartBtn").prop("disabled", true);

            var minutes, seconds;
            timer = setInterval(function () {
                minutes = parseInt(duration / 60, 10);
                seconds = parseInt(duration % 60, 10);


                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.text(minutes + ":" + seconds);

                if (--duration < 0) {
                    $("#time").text("EXPIRED!");
                    jQuery("#timerStartBtn").prop("disabled", false);
                    clearInterval(timer);
                    pomodoroCompleted();
                    return;
                }

            }, 1000);
        }

        function stopTimer() {
            bootbox.confirm("Are you sure you wish to stop the timer?", function (result) {

                if (result) {
                    clearInterval(timer);
                    jQuery("#timerStartBtn").prop("disabled", false);
                    $("#time").text("25:00");
                }

            });
        }

        function pomodoroCompleted() {
            alert("Pomodoro was completed.");

            $.ajax({
                url: "/Home/PomodoroCompleted",
                method: "GET",
                success: function () {
                    alert("Successful.");
                    $("#expToLevelHeader").load(location.href + " #expToLevelHeader")
                }
            });

        }



    </script>

}
